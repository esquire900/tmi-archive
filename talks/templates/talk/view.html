{% extends 'main_ui.html' %}
{% load static %}
{% load fullurl %}
{% block content %}
    <nav aria-label="breadcrumb" class="pt-2">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'site_index' %}">Home</a>
            </li>
            <li class="breadcrumb-item">
                            <a href="{% url 'talk_index' %}">Talks</a>
                        </li>
            <li class="breadcrumb-item active">
                {{ talk.title }}
            </li>
        </ol>
    </nav>
    <h1 class="display pt-2 pb-2">{{ talk.title }}</h1>

    <div class="row">
        <div class="col-8">
            <div class="card">
                <div class="card-body">
                    <div class="card-text">

                        {% if audio_url %}
                            <script lang="javascript">
                                {#chaptermarks#}
                                window.playerConfiguration = {
                                    "options": {
                                        "theme": "default",
                                        "startPanels": ["EpisodeInfo", "Transcript"]
                                    },
                                    "extensions": {
                                        "EpisodeInfo": {
                                            "showOnStart": true
                                        },
                                        "Playlist": {
                                            "showOnStart": true
                                        },
                                        "Transcript": {
                                            "showOnStart": true
                                        },
                                        'Share': {
                                            "disabled": true
                                        },
                                    },
                                    "episode": {
                                        "media": {
                                            "mp3": "{{ audio_url }}"
                                        },
                                        "url": "{{ request.build_absolute_uri }}",
                                        "title": "{{ talk.title }}",
                                        "transcript": "//tmi-archive.com{% url 'talk_transcription' pk=talk.id %}",
                                    }
                                }
                            </script>
                            <script class="podigee-podcast-player"
                                    src="https://cdn.podigee.com/podcast-player/javascripts/podigee-podcast-player.js"
                                    data-configuration="playerConfiguration"></script>

                        {% else %}
                            There is no audio for this talk.
                        {% endif %}

                        <hr>
                        {{ talk.description|safe }}

                        <hr>
                        <div id="transcription">
                            <h2>Transcription</h2>
                            <div class="collapse" id="transcriptionCollapse" aria-expanded="false">
                                {{ talk.transcription_text | safe }}

                            </div>
                            <a role="button" class="collapsed" data-toggle="collapse" href="#transcriptionCollapse"
                                                               aria-expanded="false" aria-controls="collapseExample"></a>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="col-4">
            <div class="card">
                <div class="card-body">
                    <div class="card-text">
                        <nav class="nav flex-column">
                            <a class="nav-link" href="{% url 'talk_edit' pk=talk.id %}">Edit talk</a>
                            {% if talk.has_audio %}
                                <a class="nav-link" href="{% url 'talk_download' pk=talk.id %}">Download audio (mp3)</a>
                                <a class="nav-link" href="{% url 'talk_download_original' pk=talk.id %}">Download
                                    original
                                    audio</a>
                                <a class="nav-link" href="{% url 'talk_view_original' pk=talk.id %}">
                                    Listen to original audio
                                </a>
                            {% endif %}
                        </nav>
                        <hr>
                        * Audio files are cleaned with AI to reduce background noises. The original files are still
                        accessible through the "original" links above.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        #transcription #transcriptionCollapse.collapse:not(.show) {
            display: block;
            height: 3rem;
            overflow: hidden;
        }

        #transcription #transcriptionCollapse.collapsing {
            height: 3rem;
        }

        #transcription a.collapsed::after {
            content: '+ Show full transcription';
        }

        #transcription a:not(.collapsed)::after {
            content: '- Show Less';
        }
    </style>
{% endblock %}
